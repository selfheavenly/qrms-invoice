# QRMS Invoice Request Web App

## ‚úÖ Project Overview

### üéØ Purpose:

To replace a limited field-validation process in QRMS with a **simple, browser-based web app** that requestors can use to submit invoice requests with proper structure and validation. The output will be a **standardized Excel file** that can be attached to QRMS and used by accountants to **automatically post invoices in SAP**.

---

## üí° Key Features & Flow

### 1. **Web App Form (Frontend Only)**

- Hosted as a **static React app** (no backend).
- Accessible via a link, works in any modern browser on desktop or mobile.
- No login or installation required.

### 2. **Form Logic**

- Requestor can fill in multiple **invoices**.
- Each invoice can have multiple **line items**.
- Example structure:

  ```
  Invoice 1
    - Line A
    - Line B
  Invoice 2
    - Line A
    - Line B
    - Line C
  ```

### 3. **Validation**

To ensure correctness, consistency, and compatibility with SAP posting automation, the form applies validation at **three hierarchical levels**: **QRMS**, **Invoice**, and **Line**.

---

### üî∑ **QRMS Level**

#### Required

- **QRMS Number**

---

### üßæ **Invoice Level**

Each form submission may include multiple invoices. Each **invoice** must contain:

#### Required

- **Company Code**
- **Document Type**
- **Document Date**
- **Customer**
- **Currency**

#### Optional

- **Header Text**

---

### üìÑ **Line Level**

Each invoice must contain at least one **line item**. For every line:

#### Required

- **Amount in Document Currency** _(must be a positive number)_
- **Item Text**
- **GL Account**

#### Optional

- **Tax Code**

---

### ‚ö†Ô∏è **Line-Level Conditional Requirements**

Each line must satisfy **at least one** of the following conditional groups:

---

#### a) **COPA Fields**

_(If selected, all required COPA fields must be filled)_

- COPA - Profit Center
- COPA - BRS Channel
- COPA - Sales Organization
- COPA - Sales Office
- COPA - Customer
- COPA - Product _(optional)_
- COPA - Product Group

> ‚úÖ All COPA fields except _Product_ are mandatory when using this option.

---

#### b) **Rebilling Fields**

_(Only required if Tax Code is `S3` or `S4`)_

- **Cross-Company Code**
- **Trading Partner**

---

#### c) **Profit Center**

- **Profit Center** (single field)

---

#### d) **Cost Center**

- **Cost Center** (single field)

---

#### e) **WBS Element**

- **WBS Element** (single field)

---

### ‚úÖ Summary

A form submission is **valid** when:

- All **required fields** at each level (QRMS, Invoice, Line) are filled
- Each line satisfies **at least one** of the conditional groups (a-e)

This ensures data consistency, enforces business logic, and supports automation-ready exports for SAP integration.

### 4. **Export**

Upon submission, the app generates and downloads a standardized **Excel file (.xlsx)** using [SheetJS (xlsx)](https://sheetjs.com/). This file serves as a structured interface between the web form and SAP, allowing for direct integration with SAP‚Äôs **batch input transaction**.

---

### üßæ Export Format & Structure

- **Each line item** in the form becomes **one row** in the Excel file.
- The output contains **a fixed set of columns**, in the exact order required by SAP.
- Columns **must not be removed or reordered**, even if they are empty ‚Äî this ensures compatibility with automated SAP imports.

---

### üì§ Excel Output Columns (SAP Batch Format)

| Column Header      | Description / Mapping from Form Fields                    |
| ------------------ | --------------------------------------------------------- |
| `ID`               | Autogenerated (used to group invoice lines)               |
| `LEDGER_GROUP`     | _(empty)_                                                 |
| `COMP_CODE`        | ‚Üí **Company Code** _(Invoice)_                            |
| `DOC_DATE`         | ‚Üí **Document Date** _(Invoice)_                           |
| `PSTNG_DATE`       | Current date                                              |
| `FIS_PERIOD`       | _(empty)_                                                 |
| `DOC_TYPE`         | ‚Üí **Document Type** _(Invoice)_                           |
| `HEADER_TXT`       | ‚Üí **Header Text** _(Invoice Optional)_                    |
| `REF_DOC_NO`       | ‚Üí **QRMS Number** _(QRMS Level)_                          |
| `REASON_REV`       | _(empty)_                                                 |
| `PLANNED_REV_DATE` | _(empty)_                                                 |
| `EXCH_RATE`        | _(empty)_                                                 |
| `POST_KEY`         | ‚Üí **Posting Key** _Derived (e.g. based on doc type)_      |
| `GL_ACCOUNT`       | ‚Üí **GL Account** _(Line)_                                 |
| `ZZALTACC`         | _(empty)_                                                 |
| `CUSTOMER`         | ‚Üí **Customer** _(Invoice)_                                |
| `VENDOR_NO`        | _(empty)_                                                 |
| `SP_GL_IND`        | _(empty)_                                                 |
| `PMNTTRMS`         | _(empty)_                                                 |
| `BLINE_DATE`       | _(empty)_                                                 |
| `PMNT_BLOCK`       | _(empty)_                                                 |
| `CURRENCY`         | ‚Üí **Currency** _(Invoice)_                                |
| `WRBTR`            | ‚Üí **Amount in Document Currency (gross/brutto)** _(Line)_ |
| `DMBTR`            | _(empty)_                                                 |
| `DMBE3`            | _(empty)_                                                 |
| `TAX_CODE`         | ‚Üí **Tax Code** _(Line Optional)_                          |
| `ALLOC_NMBR`       | ‚Üí **QRMS Number** _(QRMS Level)_                          |
| `ITEM_TEXT`        | ‚Üí **Item Text** _(Line)_                                  |
| `XREF2`            | _(empty)_                                                 |
| `TRADE_ID`         | ‚Üí **Trading Partner** _(Line Conditional)_                |
| `COSTCENTER`       | ‚Üí **Cost Center** _(Line Conditional)_                    |
| `FKBER`            | _(empty)_                                                 |
| `PROFIT_CTR`       | ‚Üí **Profit Center** _(Line Conditional)_                  |
| `WBS_ELEMENT`      | ‚Üí **WBS Element** _(Line Conditional)_                    |
| `ORDERID`          | _(empty)_                                                 |
| `PERSON_NO`        | _(empty)_                                                 |
| `QUANTITY`         | _(empty)_                                                 |
| `BASE_UOM`         | _(empty)_                                                 |
| `MATERIAL`         | _(empty)_                                                 |
| `PLANT`            | _(empty)_                                                 |
| `CROSS_COCODE`     | ‚Üí **Cross-Company Code** _(if Tax Code is S3/S4)_         |
| `COCO_NUM`         | _(empty)_                                                 |
| `COPA_PRCTR`       | ‚Üí **COPA - Profit Center** _(Line Conditional)_           |
| `COPA_WW050`       | ‚Üí **COPA - BRS Channel** _(Line Conditional)_             |
| `COPA_VKORG`       | ‚Üí **COPA - Sales Organization** _(Line Conditional)_      |
| `COPA_KMVKBU`      | ‚Üí **COPA - Sales Office** _(Line Conditional)_            |
| `COPA_WERKS`       | _(empty)_                                                 |
| `COPA_WW110`       | _(empty)_                                                 |
| `COPA_KNDNR`       | ‚Üí **COPA - Customer** _(Line Conditional)_                |
| `COPA_KDGRP`       | _(empty)_                                                 |
| `COPA_WW210`       | _(empty)_                                                 |
| `COPA_KUNRG`       | _(empty)_                                                 |
| `COPA_ARTNR`       | ‚Üí **COPA - Product** _(Line optional Conditional)_        |
| `COPA_WW040`       | ‚Üí **COPA - Product Group** _(Line Conditional)_           |
| `COPA_WW080`       | _(empty)_                                                 |
| `COPA_MATKL`       | _(empty)_                                                 |
| `COPA_EXTWG`       | _(empty)_                                                 |
| `COPA_WW010`       | _(empty)_                                                 |
| `COPA_WW020`       | _(empty)_                                                 |
| `COPA_WW030`       | _(empty)_                                                 |
| `COPA_WW070`       | _(empty)_                                                 |
| `COPA_WW100`       | _(empty)_                                                 |
| `COPA_AUGRU`       | _(empty)_                                                 |
| `COPA_ZZLUR`       | _(empty)_                                                 |
| `COPA_WW090`       | _(empty)_                                                 |

---

### üîÅ Transformation Logic

- Form inputs from the user are **mapped and transformed** into this flat structure.
- Any fields not filled by the requestor are exported as **empty cells**, not omitted.
- This ensures compatibility with a **fixed-column SAP import format**.

### 5. **Deployment**

- No backend, no database.
- App will be **hosted for free on GitHub Pages**.
- All data is processed and exported locally in the browser.

---

## üß± Tech Stack

| Tool                   | Purpose                                             |
| ---------------------- | --------------------------------------------------- |
| **Bun**                | Project setup, fast dependency manager & dev server |
| **React + TypeScript** | UI and logic                                        |
| **react-hook-form**    | Form handling                                       |
| **zod**                | Validation schema                                   |
| **xlsx (SheetJS)**     | Excel export                                        |
| **TailwindCSS**        | Styling                                             |
| **shadcn/ui**          | Optional modern UI components                       |
| **GitHub Pages**       | Free deployment (static hosting with HTTPS)         |

---

## üö´ Constraints

- **No budget** ‚Äî only development time
- Must work **offline** once loaded (no backend/API calls)
- Should be **quick to build** and easy to maintain
- Needs to be **corporate firewall-friendly** (no external APIs)

---

## ‚úÖ Benefits

- Reduces back-and-forth communication between teams
- Ensures data quality before request reaches accounting
- Standardizes input format for automation in SAP
- Easy to roll out to users (just a link)
