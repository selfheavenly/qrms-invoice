# QRMS Invoice Request Web App

## ✅ Project Overview

### 🎯 Purpose:

To replace a limited field-validation process in QRMS with a **simple, browser-based web app** that requestors can use to submit invoice requests with proper structure and validation. The output will be a **standardized Excel file** that can be attached to QRMS and used by accountants to **automatically post invoices in SAP**.

---

## 💡 Key Features & Flow

### 1. **Web App Form (Frontend Only)**

- Hosted as a **static React app** (no backend).
- Accessible via a link, works in any modern browser on desktop or mobile.
- No login or installation required.

### 2. **Form Logic**

- Requestor can fill in multiple **invoices**.
- Each invoice can have multiple **line items**.
- Example structure:

  ```
  Invoice 1
    - Line A
    - Line B
  Invoice 2
    - Line A
    - Line B
    - Line C
  ```

---

### 3. **Validation**

To ensure correctness, consistency, and compatibility with SAP posting automation, the form applies validation at **three hierarchical levels**: **QRMS**, **Invoice**, and **Line**.

---

### 🔷 **QRMS Level**

Each submission must include:

#### ✅ Required

- **QRMS Number** – must be at least 2 characters

---

### 🧾 **Invoice Level**

Each submission may contain **multiple invoices**. Every **invoice** must include:

#### ✅ Required

- **Company Code** – must be exactly 4 characters and one of the predefined company codes
- **Document Type** – must be exactly 2 characters and one of the allowed SAP document types
- **Document Date**
- **Customer** – must be at least 4 digits, numeric only
- **Currency** – must be exactly 3 characters and one of the allowed currency codes

#### 📝 Optional

- **Header Text**

---

### 📄 **Line Level**

Each invoice must have **at least one line item**. Every **line** must include:

#### ✅ Required

- **Amount in Document Currency** – must be a positive number
- **Item Text** – minimum 2 characters
- **GL Account** – must be exactly 8 digits, numeric only

#### 📝 Optional

- **Tax Code** – if provided, must be 2 characters

---

### ⚠️ **Line-Level Conditional Requirements**

Each line must satisfy **at least one** of the following conditional groups:

---

#### a) **COPA Fields Group**

Used when full COPA breakdown is available. If this group is selected, all **required** COPA fields must be filled:

- **COPA - Profit Center**
- **COPA - BRS Channel**
- **COPA - Sales Organization**
- **COPA - Sales Office**
- **COPA - Customer**
- **COPA - Product Group**

> 🟢 **Product** is optional in this group
> ✅ All other fields are **mandatory** if using this group

---

#### b) **Rebilling Group**

Required **only when** `Tax Code` is `"S3"` or `"S4"`:

- **Cross-Company Code**
- **Trading Partner**

---

#### c) **Profit Center Group**

- **Profit Center**

---

#### d) **Cost Center Group**

- **Cost Center**

---

#### e) **WBS Element Group**

- **WBS Element**

---

### ✅ Summary

A submission is considered **valid** when:

- All **required fields** at QRMS, Invoice, and Line levels are present and valid
- Each **line item** satisfies **at least one** of the following:

  - Full **COPA** group (a)
  - **Rebilling** group (b), if Tax Code is `S3` or `S4`
  - Standalone **Profit Center**, **Cost Center**, or **WBS Element** group (c-e)

This validation structure ensures:

- **Data completeness**
- **SAP compatibility**
- **Alignment with business logic and automation expectations**

### 4. **Export**

Upon form submission, the app generates and downloads a standardized **Excel file (.xlsx)** using [SheetJS (xlsx)](https://sheetjs.com/). This file acts as a structured interface between the web form and SAP, enabling compatibility with SAP’s **batch input process**.

---

### 🧾 Export Format & Structure

- Each **invoice** results in:

  - **One summary row** (aggregated amount, includes `CUSTOMER`)
  - Followed by **multiple line rows** (per item, without `CUSTOMER`)

- The export uses a **fixed set of columns** (from `technicalHeaders`), **always in the same order**.
- The sheet starts with:

  1. **Label row** — friendly names (from `labelHeaders`)
  2. **Technical row** — SAP field names (from `technicalHeaders`)
  3. **Data rows** — generated from the form

---

### 📤 Excel Output Columns (SAP Batch Format)

| Column Header      | Description / Source                                                                                  |
| ------------------ | ----------------------------------------------------------------------------------------------------- |
| `ID`               | Autogenerated — groups all lines under the same invoice                                               |
| `LEDGER_GROUP`     | _(empty)_                                                                                             |
| `COMP_CODE`        | → **Company Code** _(Invoice)_                                                                        |
| `DOC_DATE`         | → **Document Date** _(Invoice)_ formatted as `dd.mm.yyyy`                                             |
| `PSTNG_DATE`       | → **Today's Date**                                                                                    |
| `FIS_PERIOD`       | _(empty)_                                                                                             |
| `DOC_TYPE`         | → **Document Type** _(Invoice)_                                                                       |
| `HEADER_TXT`       | → **Header Text** _(Optional)_                                                                        |
| `REF_DOC_NO`       | → **QRMS Number**, formatted as `QRMS <number>` if provided                                           |
| `REASON_REV`       | _(empty)_                                                                                             |
| `PLANNED_REV_DATE` | _(empty)_                                                                                             |
| `EXCH_RATE`        | _(empty)_                                                                                             |
| `POST_KEY`         | **Derived via `getPostingKey()`**:<br> → `01`/`11` for summary, `50`/`40` for lines based on doc type |
| `GL_ACCOUNT`       | → **GL Account** _(Line only)_                                                                        |
| `ZZALTACC`         | _(empty)_                                                                                             |
| `CUSTOMER`         | → **Customer** _(Summary only)_                                                                       |
| `VENDOR_NO`        | _(empty)_                                                                                             |
| `SP_GL_IND`        | _(empty)_                                                                                             |
| `PMNTTRMS`         | _(empty)_                                                                                             |
| `BLINE_DATE`       | _(empty)_                                                                                             |
| `PMNT_BLOCK`       | _(empty)_                                                                                             |
| `CURRENCY`         | → **Currency** _(Invoice)_                                                                            |
| `WRBTR`            | → **Amount** _(negated depending on posting key)_ formatted with 2 decimals and comma separator       |
| `DMBTR`            | _(empty)_                                                                                             |
| `DMBE3`            | _(empty)_                                                                                             |
| `TAX_CODE`         | → **Tax Code** _(Line optional)_                                                                      |
| `ALLOC_NMBR`       | → **QRMS Number** (same as `REF_DOC_NO`)                                                              |
| `ITEM_TEXT`        | → **Item Text** _(Line optional)_                                                                     |
| `XREF2`            | _(empty)_                                                                                             |
| `TRADE_ID`         | → **Trading Partner** _(Line conditional)_                                                            |
| `COSTCENTER`       | → **Cost Center** _(Line conditional)_                                                                |
| `FKBER`            | _(empty)_                                                                                             |
| `PROFIT_CTR`       | → **Profit Center** _(Line conditional)_                                                              |
| `WBS_ELEMENT`      | → **WBS Element** _(Line conditional)_                                                                |
| `ORDERID`          | _(empty)_                                                                                             |
| `PERSON_NO`        | _(empty)_                                                                                             |
| `QUANTITY`         | _(empty)_                                                                                             |
| `BASE_UOM`         | _(empty)_                                                                                             |
| `MATERIAL`         | _(empty)_                                                                                             |
| `PLANT`            | _(empty)_                                                                                             |
| `CROSS_COCODE`     | → **Cross-Company Code** _(Only if `TAX_CODE` is `S3` or `S4`)_                                       |
| `COCO_NUM`         | _(empty)_                                                                                             |
| `COPA_PRCTR`       | → **COPA - Profit Center** _(Line optional)_                                                          |
| `COPA_WW050`       | → **COPA - BRS Channel** _(Line optional)_                                                            |
| `COPA_VKORG`       | → **COPA - Sales Org** _(Line optional)_                                                              |
| `COPA_KMVKBU`      | → **COPA - Sales Office** _(Line optional)_                                                           |
| `COPA_WERKS`       | _(empty)_                                                                                             |
| `COPA_WW110`       | _(empty)_                                                                                             |
| `COPA_KNDNR`       | → **COPA - Customer** _(Line optional)_                                                               |
| `COPA_KDGRP`       | _(empty)_                                                                                             |
| `COPA_WW210`       | _(empty)_                                                                                             |
| `COPA_KUNRG`       | _(empty)_                                                                                             |
| `COPA_ARTNR`       | → **COPA - Product** _(Line optional)_                                                                |
| `COPA_WW040`       | → **COPA - Product Group** _(Line optional)_                                                          |
| `COPA_WW080`       | _(empty)_                                                                                             |
| `COPA_MATKL`       | _(empty)_                                                                                             |
| `COPA_EXTWG`       | _(empty)_                                                                                             |
| `COPA_WW010`       | _(empty)_                                                                                             |
| `COPA_WW020`       | _(empty)_                                                                                             |
| `COPA_WW030`       | _(empty)_                                                                                             |
| `COPA_WW070`       | _(empty)_                                                                                             |
| `COPA_WW100`       | _(empty)_                                                                                             |
| `COPA_AUGRU`       | _(empty)_                                                                                             |
| `COPA_ZZLUR`       | _(empty)_                                                                                             |
| `COPA_WW090`       | _(empty)_                                                                                             |

---

### 🔁 Transformation Logic Summary

- **Invoices** are converted into:

  - **1 summary row** (customer amount total, with `CUSTOMER`)
  - **n line rows** (detailed items, without `CUSTOMER`)

- Amounts are **negated** for posting keys `"11"`, `"50"`, and `"40"` as needed
- Dates are formatted as `dd.mm.yyyy`, amounts as `1,234.56`
- Output always includes **label + technical headers** as the first two rows
- **Empty fields remain present** — required for SAP compatibility

---

### 5. **Deployment**

- No backend, no database.
- App will be **hosted for free on GitHub Pages**.
- All data is processed and exported locally in the browser.

---

## 🧱 Tech Stack

| Tool                   | Purpose                                             |
| ---------------------- | --------------------------------------------------- |
| **Bun**                | Project setup, fast dependency manager & dev server |
| **React + TypeScript** | UI and logic                                        |
| **react-hook-form**    | Form handling                                       |
| **zod**                | Validation schema                                   |
| **xlsx (SheetJS)**     | Excel export                                        |
| **TailwindCSS**        | Styling                                             |
| **shadcn/ui**          | Optional modern UI components                       |
| **GitHub Pages**       | Free deployment (static hosting with HTTPS)         |

---

## 🚫 Constraints

- **No budget** — only development time
- Must work **offline** once loaded (no backend/API calls)
- Should be **quick to build** and easy to maintain
- Needs to be **corporate firewall-friendly** (no external APIs)

---

## ✅ Benefits

- Reduces back-and-forth communication between teams
- Ensures data quality before request reaches accounting
- Standardizes input format for automation in SAP
- Easy to roll out to users (just a link)
